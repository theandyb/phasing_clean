---
title: "venn_diagram"
author: "Andy Beck"
date: "2024-02-20"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r, include=FALSE}
library(tidyverse)
library(ggExtra)
library(ggVennDiagram)
library(limma)
source("code/common_functions.R")
'%!in%' <- function(x,y)!('%in%'(x,y))
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
library(yaml)

library(gtsummary)

library(grid)
library(gridExtra) 

config_obj <- yaml::read_yaml("_config.yaml")

eagle_switch_dir <-   paste0(config_obj$base_dir,"/output/switch_errors/switch_errors/eagle/annotated/")
shapeit_switch_dir <- paste0(config_obj$base_dir,"/output/switch_errors/switch_errors/shapeit/annotated/")
beagle_switch_dir <-  paste0(config_obj$base_dir,"/output/switch_errors/switch_errors/beagle/annotated/")
num_sites_dir <-      paste0(config_obj$base_dir,"/output/switch_errors/vcf_n_sites/")
het_loc_dir <-        paste0(config_obj$base_dir,"/output/switch_errors/het_loc/annotated/")

sample_info_df <- read_csv("data/1kgp/subject_info.csv") %>%
  select(SAMPLE_NAME, POPULATION, SUPER)

pair_info_df <- read_delim("data/sample_pairs.csv", col_names = c("POP", "ID1", "ID2"))
pair_info_df <- left_join(pair_info_df, sample_info_df, by = c("ID1"="SAMPLE_NAME")) %>%
  rename(SP = SUPER) %>%
  select(-POPULATION)

df_freq  <- read_tsv(paste0(config_obj$base_dir,"/data/1kgp/chrX_maf.tsv"),
                   col_names = c("chrom", "pos", "maf"))

rr_df <- read_tsv("data/decode/chrX_recomb.bed", col_names = c("chr", "pos_start", "pos_end", "rr"))
```

```{r}
rr_df %>%
  ggplot(aes(x = pos_start, y = rr)) +
  geom_point()
```

# Introduction

In this document we will explore the construction of a "venn diagram" of the overlap of phasing errors across three methods over 1000 synthetic diploids. Intuitively, this makes sense for a single synthetic diploid: we partition all errors into categories determined by which method(s) produced the error. The potential complication is if we wish to look only at particular classes of errors, e.g. switches or flips. For an example of what can happen, suppose a heterozygous location is the site of a switch in Beagle. That same position could be the location of a switch in Eagle or SHAPEIT, or it may have been correctly phased. Those are not exhaustive, however; another potential outcome is that same location is the latter half of a flip error in either Eagle or SHAPEIT. Is this still considered an overlapping switch?

For a first pass, I'll be a bit exhaustive in terms of the categories of overlap for the errors in a single synthetic diploid.

```{r}
load_het_pos <- function(id, het_loc_dir){
  fname <- paste0(het_loc_dir, "pair_", id, ".csv")
  return(read_csv(fname, show_col_types = FALSE))
}

load_switch_df <- function(id, switch_dir){
  fname <- paste0(switch_dir, "switch_", id, ".csv")
  results <- read_csv(fname, show_col_types = FALSE)
  flip_loc <- get_flip_pos(results)
  results$is_flip <- (results$pos_start %in% flip_loc) | (results$pos_end %in% flip_loc)
  results$flip <- results$pos_end %in% flip_loc
  # results <- results %>%
  #   filter(flip | (!is_flip & !flip))
  # return(results %>% select(-is_flip))
  return(results)
}

annotate_het_list <- function(id, het_loc_dir, beagle_dir, eagle_dir, shapeit_dir, df_freq){
  result <- load_het_pos(id, het_loc_dir)
  df_b <- load_switch_df(id, beagle_dir)
  df_e <- load_switch_df(id, eagle_dir)
  df_s <- load_switch_df(id, shapeit_dir)
  
  result$switch_b <- result$pos %in% {df_b %>% filter(!is_flip) %>% pull(pos_end)}
  result$flip_b <- result$pos %in% {df_b %>% filter(flip) %>% pull(pos_end)}
  result$flip2_b <- result$pos %in% {df_b %>% filter(is_flip & !flip) %>% pull(pos_end)}
  
  result$switch_e <- result$pos %in% {df_e %>% filter(!is_flip) %>% pull(pos_end)}
  result$flip_e <- result$pos %in% {df_e %>% filter(flip) %>% pull(pos_end)}
  result$flip2_e <- result$pos %in% {df_e %>% filter(is_flip & !flip) %>% pull(pos_end)}
  
  result$switch_s <- result$pos %in% {df_s %>% filter(!is_flip) %>% pull(pos_end)}
  result$flip_s <- result$pos %in% {df_s %>% filter(flip) %>% pull(pos_end)}
  result$flip2_s <- result$pos %in% {df_s %>% filter(is_flip & !flip) %>% pull(pos_end)}
  
  result <- left_join(result,
                       {df_freq %>%
                           select(pos, maf)},
                       by = c("pos" = "pos"))
  
  return(result)
}

df <- annotate_het_list(1, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
```

For the `ggVennDiagram` library, we will want lists of positions for each error type (note that here we "double count" flips by including the positions of both involved heterozygous sites):

```{r}
x <- list(beagle = {df %>% filter(switch_b | flip_b | flip2_b) %>% pull(pos)},
          eagle = {df %>% filter(switch_e | flip_e | flip2_e) %>% pull(pos)},
          shapeit = {df %>% filter(switch_s | flip_s | flip2_s) %>% pull(pos)})
ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "red")
```

It's interesting to note here that the least populated categories in this venn diagram are those that count the overlap between two methods, with more observations in the all methods category and the individual methods ccategories. But, this venn diagram also double counts flips.

Another way to do this would be to simply consider switches and flips separately, not worrying about cases where a switch in one method overlaps a flip in another.

```{r}
# switches
x <- list(beagle = {df %>% filter(switch_b) %>% pull(pos)},
          eagle =  {df %>% filter(switch_e) %>% pull(pos)},
          shapeit =  {df %>% filter(switch_s) %>% pull(pos)})
p1 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "blue")

# flips
x <- list(beagle = {df %>% filter(flip_b) %>% pull(pos)},
          eagle =  {df %>% filter(flip_e) %>% pull(pos)},
          shapeit =  {df %>% filter(flip_s) %>% pull(pos)})
p2 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "green")

gridExtra::grid.arrange(p1, p2, ncol=2)
```

Here we observe for switches that the least represented categories are the overlaps between any two categories, while the individual methods categories and the three methods overlap categories have the higher counts. On the otherhand, we see a higher degree of sharing between beagle and shapeit for flips, while shapeit dominates for the most unique flips.


Ok, hear me out: we say nuts to the above, and just do the very simple criteria of:

1. Switches are shared only with switches that occur at the same position
2. Flips are shared only with flips that start at the same position
3. Everything else is distinct as far as we care

So for each SD we get two venn diagrams with 3 circles.

```{r}
x <- list(beagle = {df %>% filter(switch_b) %>% pull(pos)},
          eagle = {df %>% filter(switch_e) %>% pull(pos)},
          shapeit = {df %>% filter(switch_s) %>% pull(pos)})
p1 <- ggVennDiagram(x, label = "count") + 
  scale_fill_gradient(low="grey90",high = "green") + 
  ggtitle("Switches") + 
  theme(plot.title = element_text(hjust = 0.5))

x <- list(beagle = {df %>% filter(flip_b) %>% pull(pos)},
          eagle = {df %>% filter(flip_e) %>% pull(pos)},
          shapeit = {df %>% filter(flip_s) %>% pull(pos)})
p2 <- ggVennDiagram(x, label="count") + 
  scale_fill_gradient(low="grey90",high = "blue") + 
  ggtitle("Flips") + 
  theme(plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,ncol=2)
```

Naturally, we may ask how many intersections of errors do we miss by considering only matching error types and, in the case of flips, only matching directly overlapping errors. First, we look at how many switches from each method overlap flips from the other two methods:

```{r}
x <- list(beagle = {df %>% filter(switch_b) %>% pull(pos)},
          eagle_flip = {df %>% filter(flip_e | flip2_e) %>% pull(pos)},
          eagle_switch = {df %>% filter(switch_e) %>% pull(pos)},
          shapeit_switch = {df %>% filter(switch_s) %>% pull(pos)},
          shapeit_flip = {df %>% filter(flip_s | flip2_s) %>% pull(pos)})
p1 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "purple") + 
  theme(plot.title = element_text(hjust = 0.5))

x <- list(beagle = {df %>% filter(switch_b) %>% pull(pos)},
          eagle_flip = {df %>% filter(flip_e | flip2_e) %>% pull(pos)},
          shapeit_flip = {df %>% filter(flip_s | flip2_s) %>% pull(pos)})
p2 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "darkgreen") + 
  theme(plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,ncol=2)
```

Here, we see that only 12 of the 92 BEAGLE switches (~13%) overlap flips from the other two methods.

```{r}
x <- list(beagle_flip = {df %>% filter(flip_b | flip2_b) %>% pull(pos)},
          beagle_switch = {df %>% filter(switch_b) %>% pull(pos)},
          eagle = {df %>% filter(switch_e) %>% pull(pos)},
          shapeit_switch = {df %>% filter(switch_s) %>% pull(pos)},
          shapeit_flip = {df %>% filter(flip_s | flip2_s) %>% pull(pos)})
p1 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "purple") + 
  theme(plot.title = element_text(hjust = 0.5))

x <- list(beagle_flip = {df %>% filter(flip_b | flip2_b) %>% pull(pos)},
          eagle = {df %>% filter(switch_e) %>% pull(pos)},
          shapeit_flip = {df %>% filter(flip_s | flip2_s) %>% pull(pos)})
p2 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "darkgreen") + 
  theme(plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,ncol=2)
```

For Eagle, around 22% of its switches overlap a SHAPEIT or Beagle flip.

```{r}
x <- list(beagle_flip = {df %>% filter(flip_b | flip2_b) %>% pull(pos)},
          beagle_switch = {df %>% filter(switch_b) %>% pull(pos)},
          eagle_switch = {df %>% filter(switch_e) %>% pull(pos)},
          eagle_flip = {df %>% filter(flip_e | flip2_e) %>% pull(pos)},
          shapeit = {df %>% filter(switch_s) %>% pull(pos)})
p1 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "purple") + 
  theme(plot.title = element_text(hjust = 0.5))

x <- list(beagle_flip = {df %>% filter(flip_b | flip2_b) %>% pull(pos)},
          eagle_flip = {df %>% filter(flip_e | flip2_e) %>% pull(pos)},
          shapeit = {df %>% filter(switch_s) %>% pull(pos)})
p2 <- ggVennDiagram(x, label = "count") + scale_fill_gradient(low="grey90",high = "darkgreen") + 
  theme(plot.title = element_text(hjust = 0.5))

gridExtra::grid.arrange(p1,p2,ncol=2)
```

And finally, for SHAPEIT, only 5 (~6%) of its switches overlap flips from either of the other two methods.

If we wanted to aggregate these counts across multiple SDs, we'd have to generate 14 numbers per SD. Is there a quick way of doing this?

```{r}
df_switch <- df %>%
  filter(switch_b | switch_e | switch_s) %>%
  mutate(beagle = ifelse(switch_b, "Y", "N"),
         eagle = ifelse(switch_e, "Y", "N"),
         shapeit = ifelse(switch_s, "Y", "N")) %>%
  mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
  pull(count_cat) %>%
  table() %>%
  as.data.frame() %>%
  rename(count_cat = ".")

df_flip <- df %>%
  filter(flip_b | flip_e | flip_s) %>%
  mutate(beagle = ifelse(flip_b, "Y", "N"),
         eagle = ifelse(flip_e, "Y", "N"),
         shapeit = ifelse(flip_s, "Y", "N")) %>%
  mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
  pull(count_cat) %>%
  table() %>%
  as.data.frame() %>%
  rename(count_cat = ".")

df_switch_noflip <- df %>%
  filter((switch_b | switch_e | switch_s) & !(flip_b | flip2_b | flip_e | flip2_e | flip_s | flip2_s)) %>%
  mutate(beagle = ifelse(switch_b, "Y", "N"),
         eagle = ifelse(switch_e, "Y", "N"),
         shapeit = ifelse(switch_s, "Y", "N")) %>%
  mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
  pull(count_cat) %>%
  table() %>%
  as.data.frame() %>%
  rename(count_cat = ".")
```

Here, we've generated three data frames: `df_switch` only considers the overlap of switches across the three methods:

```{r}
df_switch %>%
  knitr::kable()
```

The categories are Y/N in order: Beagle, Eagle, SHAPEIT (e.g., Y_Y_N has the count of Beagle switches that oveerlap with Eagle but not SHAPEIT). 

The second data frame considers flips, but only counts as overlap if the flip start matches between methods:

```{r}
df_flip %>%
  knitr::kable()
```

The final data frame again looks at the overlap of switches, but excludes switches that overlap flips in any other method:

```{r}
df_switch_noflip %>%
  knitr::kable()
```

The two switch tables allow us to get a sense of the overlap of switches and flips by subtracting the second from the first:

```{r}
df_switch_flip <- df_switch %>%
  left_join(df_switch_noflip, by = "count_cat") %>%
  mutate(flip_overlap = Freq.x - Freq.y) %>%
  select(count_cat, flip_overlap)
```



# Simple Overlap

```{r}
# Version which only does exact matches of flips and switches
get_error_counts <- function(ids, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq){
  n <- length(ids)
  results <- vector(mode = "list", length = 4)
  
  df <- annotate_het_list(ids[1], het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
  df_switch <- df %>%
    filter(switch_b | switch_e | switch_s) %>%
    mutate(beagle = ifelse(switch_b, "Y", "N"),
           eagle = ifelse(switch_e, "Y", "N"),
           shapeit = ifelse(switch_s, "Y", "N")) %>%
    mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
    pull(count_cat) %>%
    table() %>%
    as.data.frame() %>%
    rename(count_cat = ".")
  
  df_flip <- df %>%
    filter(flip_b | flip_e | flip_s) %>%
    mutate(beagle = ifelse(flip_b, "Y", "N"),
           eagle = ifelse(flip_e, "Y", "N"),
           shapeit = ifelse(flip_s, "Y", "N")) %>%
    mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
    pull(count_cat) %>%
    table() %>%
    as.data.frame() %>%
    rename(count_cat = ".")
  
  df_switch_noflip <- df %>%
    filter((switch_b | switch_e | switch_s) & !(flip_b | flip2_b | flip_e | flip2_e | flip_s | flip2_s)) %>%
    mutate(beagle = ifelse(switch_b, "Y", "N"),
           eagle = ifelse(switch_e, "Y", "N"),
           shapeit = ifelse(switch_s, "Y", "N")) %>%
    mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
    pull(count_cat) %>%
    table() %>%
    as.data.frame() %>%
    rename(count_cat = ".")
  
  df_switch_flip <- df_switch %>%
    left_join(df_switch_noflip, by = "count_cat") %>%
    mutate(Freq = Freq.x - Freq.y) %>%
    select(count_cat, Freq)
  
  for(i in 2:n){
    df <- annotate_het_list(ids[i], het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
    df_switch2 <- df %>%
      filter(switch_b | switch_e | switch_s) %>%
      mutate(beagle = ifelse(switch_b, "Y", "N"),
             eagle = ifelse(switch_e, "Y", "N"),
             shapeit = ifelse(switch_s, "Y", "N")) %>%
      mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
      pull(count_cat) %>%
      table() %>%
      as.data.frame() %>%
      rename(count_cat = ".", Freq2 = Freq)
    
    df_switch <- df_switch %>%
      full_join(df_switch2, by="count_cat") %>%
      replace_na(list("Freq" = 0, "Freq2" = 0)) %>%
      mutate(Freq = Freq + Freq2) %>%
      select(-Freq2)
      
    
    df_flip2 <- df %>%
      filter(flip_b | flip_e | flip_s) %>%
      mutate(beagle = ifelse(flip_b, "Y", "N"),
             eagle = ifelse(flip_e, "Y", "N"),
             shapeit = ifelse(flip_s, "Y", "N")) %>%
      mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
      pull(count_cat) %>%
      table() %>%
      as.data.frame() %>%
      rename(count_cat = ".", Freq2 = Freq)
    
    df_flip <- df_flip %>%
      full_join(df_flip2, by="count_cat") %>%
      replace_na(list("Freq" = 0, "Freq2" = 0)) %>%
      mutate(Freq = Freq + Freq2) %>%
      select(-Freq2)
    
    df_switch_noflip2 <- df %>%
      filter((switch_b | switch_e | switch_s) & !(flip_b | flip2_b | flip_e | flip2_e | flip_s | flip2_s)) %>%
      mutate(beagle = ifelse(switch_b, "Y", "N"),
             eagle = ifelse(switch_e, "Y", "N"),
             shapeit = ifelse(switch_s, "Y", "N")) %>%
      mutate(count_cat = paste(beagle, eagle, shapeit, sep="_")) %>%
      pull(count_cat) %>%
      table() %>%
      as.data.frame() %>%
      rename(count_cat = ".", Freq2 = Freq)
    
    df_switch_noflip <- df_switch_noflip %>%
      full_join(df_switch_noflip2, by="count_cat") %>%
      replace_na(list("Freq" = 0, "Freq2" = 0)) %>%
      mutate(Freq = Freq + Freq2) %>%
      select(-Freq2)
    
    df_switch_flip2 <- df_switch2 %>%
      left_join(df_switch_noflip2, by = "count_cat") %>%
      mutate(Freq2 = Freq2.x - Freq2.y) %>%
      select(count_cat, Freq2)
    
    df_switch_flip <- df_switch_flip %>%
      full_join(df_switch_flip2, by="count_cat") %>%
      replace_na(list("Freq" = 0, "Freq2" = 0)) %>%
      mutate(Freq = Freq + Freq2) %>%
      select(-Freq2)
  }
  results[[1]] <- df_switch
  results[[2]] <- df_flip
  results[[3]] <- df_switch_noflip
  results[[4]] <- df_switch_flip
  return(results)
}
```

## EUR

```{r}
results_eur <- get_error_counts(1:200, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

results_eur[[1]] %>%
  knitr::kable()
results_eur[[2]] %>%
  knitr::kable()
results_eur[[3]] %>%
  knitr::kable()
```

```{r}
count_to_ven <- function(x){
  df <- x %>%
    mutate(beagle = ifelse(str_sub(count_cat, 1, 1)=="Y", 1, 0),
           eagle = ifelse(str_sub(count_cat, 3, 3)=="Y", 1, 0),
           shapeit = ifelse(str_sub(count_cat, 5, 5)== "Y", 1, 0)) %>%
    select(beagle, eagle, shapeit, Freq)
  
  n_b <- df %>% filter(beagle == 1, eagle == 0, shapeit == 0) %>% pull(Freq)
  n_e <- df %>% filter(beagle == 0, eagle == 1, shapeit == 0) %>% pull(Freq)
  n_s <- df %>% filter(beagle == 0, eagle == 0, shapeit == 1) %>% pull(Freq)
  n_b_e <- df %>% filter(beagle == 1, eagle == 1, shapeit == 0) %>% pull(Freq)
  n_b_s <- df %>% filter(beagle == 1, eagle == 0, shapeit == 1) %>% pull(Freq)
  n_e_s <- df %>% filter(beagle == 0, eagle == 1, shapeit == 1) %>% pull(Freq)
  n_b_e_s <- df %>% filter(beagle == 1, eagle == 1, shapeit == 1) %>% pull(Freq)
  
  data.frame(beagle = c(rep(TRUE, n_b), rep(FALSE, n_e),rep(FALSE, n_s), rep(TRUE, n_b_e), rep(TRUE, n_b_s), rep(FALSE, n_e_s) , rep(TRUE, n_b_e_s)),
             eagle = c(rep(FALSE, n_b), rep(TRUE, n_e),rep(FALSE, n_s), rep(TRUE, n_b_e), rep(FALSE, n_b_s), rep(TRUE, n_e_s) , rep(TRUE, n_b_e_s)),
             shapeit = c(rep(FALSE, n_b), rep(FALSE, n_e), rep(TRUE, n_s), rep(FALSE, n_b_e), rep(TRUE, n_b_s), rep(TRUE, n_e_s) , rep(TRUE, n_b_e_s)) 
             ) %>%
    vennCounts() %>%
    vennDiagram() %>% print()
}

count_to_ven(results_eur[[1]])
count_to_ven(results_eur[[2]])
count_to_ven(results_eur[[3]])
```


## AFR

```{r}
results_afr <- get_error_counts(201:400, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

results_afr[[1]] %>%
  knitr::kable()
results_afr[[2]] %>%
  knitr::kable()
results_afr[[3]] %>%
  knitr::kable()

count_to_ven(results_afr[[1]])
count_to_ven(results_afr[[2]])
count_to_ven(results_afr[[3]])
```

## AMR

```{r}
results_amr <- get_error_counts(401:600, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

results_amr[[1]] %>%
  knitr::kable()
results_amr[[2]] %>%
  knitr::kable()
results_amr[[3]] %>%
  knitr::kable()

count_to_ven(results_amr[[1]])
count_to_ven(results_amr[[2]])
count_to_ven(results_amr[[3]])
```

## EAS

```{r}
results_eas <- get_error_counts(601:800, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

results_eas[[1]] %>%
  knitr::kable()
results_eas[[2]] %>%
  knitr::kable()
results_eas[[3]] %>%
  knitr::kable()

count_to_ven(results_eas[[1]])
count_to_ven(results_eas[[2]])
count_to_ven(results_eas[[3]])
```

## SAS

```{r}
results_sas <- get_error_counts(801:1000, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

results_sas[[1]] %>%
  knitr::kable()
results_sas[[2]] %>%
  knitr::kable()
results_sas[[3]] %>%
  knitr::kable()

count_to_ven(results_sas[[1]])
count_to_ven(results_sas[[2]])
count_to_ven(results_sas[[3]])
```

# Percentages

```{r}
get_single_count <- function(id, het_loc_dir,  beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq){
   df <- annotate_het_list(id, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
   
   # switches
   ## get counts of each type of overlap (7 categories)
  n_b_total <- df %>%
    pull(switch_b) %>%
    sum()
  n_e_total <- df %>%
    pull(switch_e) %>%
    sum()
  n_s_total <- df %>%
    pull(switch_s) %>%
    sum()
  ## unique to one method
  n_b <- df %>%
    filter(!(switch_e | switch_s)) %>%
    pull(switch_b) %>%
    sum()
  n_e <- df %>%
    filter(!(switch_b | switch_s)) %>%
    pull(switch_e) %>%
    sum()
  n_s <- df %>%
    filter(!(switch_b | switch_e)) %>%
    pull(switch_s) %>%
    sum()
  ## shared between two methods
  n_b_e <- df %>%
    filter(!switch_s) %>%
    filter(switch_b & switch_e) %>%
    pull(switch_b) %>% sum()
  n_b_s <- df %>%
    filter(!switch_e) %>%
    filter(switch_b & switch_s) %>%
    pull(switch_b) %>% sum()
  n_e_s <- df %>%
    filter(!switch_b) %>%
    filter(switch_e & switch_s) %>%
    pull(switch_e) %>% sum()
  
  ## shared across all three
  n_b_e_s <- df %>%
    filter(switch_b & switch_e & switch_s) %>%
    pull(switch_b) %>% sum()
  
  # flips
   ## get counts of each type of overlap (7 categories)
  f_b_total <- df %>%
    pull(flip_b) %>%
    sum()
  f_e_total <- df %>%
    pull(flip_e) %>%
    sum()
  f_s_total <- df %>%
    pull(flip_s) %>%
    sum()
  ## unique to one method
  f_b <- df %>%
    filter(!(flip_e | flip_s)) %>%
    pull(flip_b) %>%
    sum()
  f_e <- df %>%
    filter(!(flip_b | flip_s)) %>%
    pull(flip_e) %>%
    sum()
  f_s <- df %>%
    filter(!(flip_b | flip_e)) %>%
    pull(flip_s) %>%
    sum()
  ## shared between two methods
  f_b_e <- df %>%
    filter(!flip_s) %>%
    filter(flip_b & flip_e) %>%
    pull(flip_b) %>% sum()
  f_b_s <- df %>%
    filter(!flip_e) %>%
    filter(flip_b & flip_s) %>%
    pull(flip_b) %>% sum()
  f_e_s <- df %>%
    filter(!flip_b) %>%
    filter(flip_e & flip_s) %>%
    pull(flip_e) %>% sum()
  ## shared across all three
  f_b_e_s <- df %>%
    filter(flip_b & flip_e & flip_s) %>%
    pull(flip_b) %>% sum()
  
  # return data frame with counts
  return(data.frame(id = id,
                    s_b_total = n_b_total,
                    s_e_total = n_e_total,
                    s_s_total = n_s_total,
                    s_b = n_b,
                    s_e = n_e,
                    s_s = n_s,
                    s_b_e = n_b_e,
                    s_b_s = n_b_s,
                    s_e_s = n_e_s,
                    s_b_e_s = n_b_e_s,
                    f_b_total = f_b_total,
                    f_e_total = f_e_total,
                    f_s_total = f_s_total,
                    f_b = f_b,
                    f_e = f_e,
                    f_s = f_s,
                    f_b_e = f_b_e,
                    f_b_s = f_b_s,
                    f_e_s = f_e_s,
                    f_b_e_s = f_b_e_s))
}

get_error_pct <- function(ids, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq){
  n <- length(ids)
  
  results <- vector(mode = "list", length = n)
  
  for(i in 1:n){
    results[[i]] <- get_single_count(ids[i], het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
  }
  return(bind_rows(results))
}

df_err_pct <- get_error_pct(1:1000, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

df_err_pct$pop <- rep(c("EUR", "AFR", "AMR", "EAS", "SAS"), each = 200)

df_err_pct <- df_err_pct %>%
  mutate(s_unique = s_b + s_e + s_s + s_b_e + s_b_s + s_e_s + s_b_e_s,
         f_unique = f_b + f_e + f_s + f_b_e + f_b_s + f_e_s + f_b_e_s)
```

Now we can answer questions such as: for each method, what fractions of its switches are not observed in the other three methods?:

```{r}
df_err_pct %>%
  mutate(Beagle = s_b / s_b_total,
         Eagle = s_e / s_e_total,
         SHAPEIT = s_s / s_s_total) %>%
  select(pop, Beagle, Eagle, SHAPEIT) %>%
  pivot_longer(-pop, names_to = "alg", values_to = "prop") %>%
  ggplot(aes(x = alg, y = prop, colour = pop)) +
  geom_boxplot() +
  scale_color_manual(values = cbPalette) +
  labs(color = "Population") +
  xlab("Method") +
  ylab("Proportion of Unique Switches")

df_err_pct %>%
  mutate(Beagle = s_b / s_b_total,
         Eagle = s_e / s_e_total,
         SHAPEIT = s_s / s_s_total) %>%
  select(Beagle, Eagle, SHAPEIT) %>%
  tbl_summary()

df_err_pct %>%
  mutate(Beagle = s_b / s_b_total,
         Eagle = s_e / s_e_total,
         SHAPEIT = s_s / s_s_total) %>%
  select(pop, Beagle, Eagle, SHAPEIT) %>%
  tbl_summary(by = pop)
```

Conversely, what fraction are observed in at least one of the other two methods?:

```{r}
df_err_pct %>%
  mutate(Beagle = (s_b_total - s_b ) / s_b_total,
         Eagle = (s_e_total - s_e) / s_e_total,
         SHAPEIT = (s_s_total - s_s) / s_s_total) %>%
  select(pop, Beagle, Eagle, SHAPEIT) %>%
  pivot_longer(-pop, names_to = "alg", values_to = "prop") %>%
  ggplot(aes(x = alg, y = prop, colour = pop)) +
  geom_boxplot() +
  scale_color_manual(values = cbPalette) +
  labs(color = "Population") +
  xlab("Method") +
  ylab("Proportion of Shared Switches")
```

Now, considering each method in full:

## Beagle

```{r}
df_err_pct %>% 
  mutate(Beagle = s_b / s_b_total,
         Beagle_Eagle = s_b_e / s_b_total,
         Beagle_SHAPEIT = s_b_s / s_b_total,
         Beagle_Eagle_SHAPEIT = s_b_e_s / s_b_total) %>%
  select(starts_with("Beagle")) %>%
  tbl_summary(statistic = list(all_continuous() ~ "{mean} ({sd})"), digits = all_continuous() ~ 4)
```


In Beagle, on average we observe that blank % of its switches are unique to Beagle

## Alternate: percentages in each individual

```{r}
get_pct_sample <- function(id, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq){

  df <- annotate_het_list(id, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
  
  df_switch <- df %>%
    filter(switch_b | switch_e | switch_s) %>%
    mutate(beagle = ifelse(switch_b, "Y", "N"),
           eagle = ifelse(switch_e, "Y", "N"),
           shapeit = ifelse(switch_s, "Y", "N")) %>%
    mutate(count_cat = paste(beagle, eagle, shapeit, "switch", sep="_")) %>%
    pull(count_cat) %>%
    table() %>%
    as.data.frame() %>%
    rename(count_cat = ".") %>%
    mutate(prop = Freq / sum(Freq))
  
  df_flip <- df %>%
    filter(flip_b | flip_e | flip_s) %>%
    mutate(beagle = ifelse(flip_b, "Y", "N"),
           eagle = ifelse(flip_e, "Y", "N"),
           shapeit = ifelse(flip_s, "Y", "N")) %>%
    mutate(count_cat = paste(beagle, eagle, shapeit, "flip", sep="_")) %>%
    pull(count_cat) %>%
    table() %>%
    as.data.frame() %>%
    rename(count_cat = ".")  %>%
    mutate(prop = Freq / sum(Freq))
  
  df_total <- df %>%
    filter(switch_b | switch_e | switch_s | flip_b | flip_e | flip_s) %>%
    mutate(beagle = ifelse((switch_b | flip_b), "Y", "N"),
           eagle = ifelse((switch_e | flip_e), "Y", "N"),
           shapeit = ifelse((switch_s | flip_s), "Y", "N")) %>%
    mutate(count_cat = paste(beagle, eagle, shapeit, "error", sep="_")) %>%
    pull(count_cat) %>%
    table() %>%
    as.data.frame() %>%
    rename(count_cat = ".")  %>%
    mutate(prop = Freq / sum(Freq))
  
  df_res <- bind_rows(df_switch, df_flip) %>%
    bind_rows(df_total) %>%
    select(count_cat, prop) %>%
    pivot_wider(names_from = count_cat, values_from = prop)
  
  df_res$beagle_switch <- sum(df$switch_b)
  df_res$eagle_switch <- sum(df$switch_e)
  df_res$shapeit_switch <- sum(df$switch_s)
  
  df_res$beagle_flip <- sum(df$flip_b)
  df_res$eagle_flip <- sum(df$flip_e)
  df_res$shapeit_flip <- sum(df$flip_s)
  
  df_res$beagle_total <-  df_res$beagle_switch + df_res$beagle_flip
  df_res$eagle_total <-  df_res$eagle_switch + df_res$eagle_flip
  df_res$shapeit_total <-  df_res$shapeit_switch + df_res$shapeit_flip
  
  df_res$id <- id
  return(df_res)
}

get_pct_df <- function(ids, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq){
  results <- vector(mode = "list", length = length(ids))
  
  for(i in 1:length(ids)){
    results[[i]] <- get_pct_sample(ids[i], het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
  }
  return(bind_rows(results))
}

df_pct <- get_pct_df(1:1000, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
df_pct[is.na(df_pct)] <- 0

df_pct$pop <- rep(c("EUR", "AFR", "AMR", "EAS", "SAS"), each = 200)
```

With this re-formulation, we can answer questions about the distributions of proportions of error categories across individuals. For example, in a typical individual, what percent of the switches observed in that sample are unique to each of the methods?:

```{r}
df_pct %>%
  ggplot(aes(x = pop, y = Y_N_N_switch, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent switches unique to Beagle") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")

df_pct %>%
  ggplot(aes(x = pop, y = N_Y_N_switch, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent switches unique to Eagle") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")

df_pct %>%
  ggplot(aes(x = pop, y = N_N_Y_switch, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent switches unique to SHAPEIT") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")
```

What about flips?:

```{r}
df_pct %>%
  ggplot(aes(x = pop, y = Y_N_N_flip, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent flips unique to Beagle") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")

df_pct %>%
  ggplot(aes(x = pop, y = N_Y_N_flip, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent flips unique to Eagle") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")

df_pct %>%
  ggplot(aes(x = pop, y = N_N_Y_flip, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent flips unique to SHAPEIT") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")
```

Any error in general?:

```{r}
df_pct %>%
  ggplot(aes(x = pop, y = Y_N_N_error, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent errors unique to Beagle") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")

df_pct %>%
  ggplot(aes(x = pop, y = N_Y_N_error, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent errors unique to Eagle") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")

df_pct %>%
  ggplot(aes(x = pop, y = N_N_Y_error, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent errors unique to SHAPEIT") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population")
```


Or how about what proportion of errors are shared across at least two methods?:

```{r}
df_pct %>%
  mutate(shared_switch = Y_Y_N_switch + Y_Y_Y_switch + Y_N_Y_switch + N_Y_Y_switch) %>%
  ggplot(aes(x = pop, y = shared_switch, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent switches overlap") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population") +
  ggtitle("Proportion of Non-unique Switches")

df_pct %>%
  mutate(shared_switch = Y_Y_N_switch + Y_Y_Y_switch + Y_N_Y_switch + N_Y_Y_switch,
         unique_switch = Y_N_N_switch + N_Y_N_switch + N_N_Y_switch) %>%
  rename(Beagle = Y_N_N_switch, Eagle = N_Y_N_switch, SHAPEIT = N_N_Y_switch,
         Beagle_Eagle = Y_Y_N_switch, Beagle_SHAPEIT = Y_N_Y_switch, Eagle_SHAPEIT = N_Y_Y_switch,
         Beagle_Eagle_SHAPEIT = Y_Y_Y_switch) %>%
  tbl_summary(include = c(shared_switch, unique_switch, 
                          Beagle, Eagle, SHAPEIT,
                          Beagle_Eagle, Beagle_SHAPEIT, Eagle_SHAPEIT,
                          Beagle_Eagle_SHAPEIT), by = pop, statistic = list(
                all_continuous() ~ "{mean} ({sd})",
                all_categorical() ~ "{n} / {N} ({p}%)"))

df_pct %>%
  mutate(shared_switch = Y_Y_N_switch + Y_Y_Y_switch + Y_N_Y_switch + N_Y_Y_switch,
         unique_switch = Y_N_N_switch + N_Y_N_switch + N_N_Y_switch) %>%
  rename(Beagle = Y_N_N_switch, Eagle = N_Y_N_switch, SHAPEIT = N_N_Y_switch,
         Beagle_Eagle = Y_Y_N_switch, Beagle_SHAPEIT = Y_N_Y_switch, Eagle_SHAPEIT = N_Y_Y_switch,
         Beagle_Eagle_SHAPEIT = Y_Y_Y_switch) %>%
  tbl_summary(include = c(shared_switch, unique_switch, 
                          Beagle, Eagle, SHAPEIT,
                          Beagle_Eagle, Beagle_SHAPEIT, Eagle_SHAPEIT,
                          Beagle_Eagle_SHAPEIT), statistic = list(
                all_continuous() ~ "{mean} ({sd})",
                all_categorical() ~ "{n} / {N} ({p}%)"))
```

```{r}
df_pct %>%
  mutate(shared_switch = Y_Y_N_flip + Y_Y_Y_flip + Y_N_Y_flip + N_Y_Y_flip) %>%
  ggplot(aes(x = pop, y = shared_switch, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent flips overlap") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population") +
  ggtitle("Proportion of Non-unique Flips")

df_pct %>%
  mutate(shared_flip = Y_Y_N_flip + Y_Y_Y_flip + Y_N_Y_flip + N_Y_Y_flip,
         unique_flip = Y_N_N_flip + N_Y_N_flip + N_N_Y_flip) %>%
  rename(Beagle = Y_N_N_flip, Eagle = N_Y_N_flip, SHAPEIT = N_N_Y_flip,
         Beagle_Eagle = Y_Y_N_flip, Beagle_SHAPEIT = Y_N_Y_flip, Eagle_SHAPEIT = N_Y_Y_flip,
         Beagle_Eagle_SHAPEIT = Y_Y_Y_flip) %>%
  tbl_summary(include = c(shared_flip, unique_flip, 
                          Beagle, Eagle, SHAPEIT,
                          Beagle_Eagle, Beagle_SHAPEIT, Eagle_SHAPEIT,
                          Beagle_Eagle_SHAPEIT), by = pop, statistic = list(
                all_continuous() ~ "{mean} ({sd})",
                all_categorical() ~ "{n} / {N} ({p}%)"))

df_pct %>%
  mutate(shared_flip = Y_Y_N_flip + Y_Y_Y_flip + Y_N_Y_flip + N_Y_Y_flip,
         unique_flip = Y_N_N_flip + N_Y_N_flip + N_N_Y_flip) %>%
  rename(Beagle = Y_N_N_flip, Eagle = N_Y_N_flip, SHAPEIT = N_N_Y_flip,
         Beagle_Eagle = Y_Y_N_flip, Beagle_SHAPEIT = Y_N_Y_flip, Eagle_SHAPEIT = N_Y_Y_flip,
         Beagle_Eagle_SHAPEIT = Y_Y_Y_flip) %>%
  tbl_summary(include = c(shared_flip, unique_flip, 
                          Beagle, Eagle, SHAPEIT,
                          Beagle_Eagle, Beagle_SHAPEIT, Eagle_SHAPEIT,
                          Beagle_Eagle_SHAPEIT), statistic = list(
                all_continuous() ~ "{mean} ({sd})",
                all_categorical() ~ "{n} / {N} ({p}%)"))
```

```{r}
df_pct %>%
  mutate(shared_error = Y_Y_N_error + Y_Y_Y_error + Y_N_Y_error + N_Y_Y_error) %>%
  ggplot(aes(x = pop, y = shared_error, colour = pop)) +
  geom_boxplot() +
  xlab("Super population") +
  ylab("Percent error overlap") +
  scale_colour_manual(values = cbPalette) +
  theme_classic() +
  labs(color = "Population") +
  ggtitle("Proportion of Non-unique Errors")

df_pct %>%
  mutate(shared_error = Y_Y_N_error + Y_Y_Y_error + Y_N_Y_error + N_Y_Y_error,
         unique_error = Y_N_N_error + N_Y_N_error + N_N_Y_error) %>%
  rename(Beagle = Y_N_N_error, Eagle = N_Y_N_error, SHAPEIT = N_N_Y_error,
         Beagle_Eagle = Y_Y_N_error, Beagle_SHAPEIT = Y_N_Y_error, Eagle_SHAPEIT = N_Y_Y_error,
         Beagle_Eagle_SHAPEIT = Y_Y_Y_error) %>%
  tbl_summary(include = c(shared_error, unique_error, 
                          Beagle, Eagle, SHAPEIT,
                          Beagle_Eagle, Beagle_SHAPEIT, Eagle_SHAPEIT,
                          Beagle_Eagle_SHAPEIT), by = pop, statistic = list(
                all_continuous() ~ "{mean} ({sd})",
                all_categorical() ~ "{n} / {N} ({p}%)"))

df_pct %>%
  mutate(shared_error = Y_Y_N_error + Y_Y_Y_error + Y_N_Y_error + N_Y_Y_error,
         unique_error = Y_N_N_error + N_Y_N_error + N_N_Y_error) %>%
  rename(Beagle = Y_N_N_error, Eagle = N_Y_N_error, SHAPEIT = N_N_Y_error,
         Beagle_Eagle = Y_Y_N_error, Beagle_SHAPEIT = Y_N_Y_error, Eagle_SHAPEIT = N_Y_Y_error,
         Beagle_Eagle_SHAPEIT = Y_Y_Y_error) %>%
  tbl_summary(include = c(shared_error, unique_error, 
                          Beagle, Eagle, SHAPEIT,
                          Beagle_Eagle, Beagle_SHAPEIT, Eagle_SHAPEIT,
                          Beagle_Eagle_SHAPEIT), statistic = list(
                all_continuous() ~ "{mean} ({sd})",
                all_categorical() ~ "{n} / {N} ({p}%)"))
```

HERE ANDY

# Errors in Bins

To get the sense of how much the methods overlap in a larger scale, we'll look at the aggregate number of errors in bins across the genome for both switches and flips. First, let's take a look at what this overlap looks like within a single synthetic diploid:

```{r}
bin_size <- 1e6 # try 1MB
df <- annotate_het_list(1, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq) %>%
  mutate(bin_id = ceiling(pos / bin_size))
```

Let's first look at switches across bins

```{r}
df %>%
  group_by(bin_id) %>%
  summarize(beagle = sum(switch_b),
            eagle = sum(switch_e),
            shapeit = sum(switch_s)) %>%
  pivot_longer(-bin_id, names_to = "method", values_to = "switches") %>%
  ggplot(aes(x = bin_id, y = switches, color = method)) +
  geom_point() +
  geom_line() +
  theme_classic()
```

Now let's lower our resolution and look at 10MB bins:

```{r}
bin_size <- 1e7
df %>%
  mutate(bin_id = ceiling(pos / bin_size)) %>%
  group_by(bin_id) %>%
  summarize(beagle = sum(switch_b),
            eagle = sum(switch_e),
            shapeit = sum(switch_s)) %>%
  pivot_longer(-bin_id, names_to = "method", values_to = "switches") %>%
  ggplot(aes(x = bin_id, y = switches, color = method)) +
  geom_point() +
  geom_line() +
  theme_classic()
```

## EUR

Now let's see what this distribution looks like across all EUR SDs. First, on the MB scale:

### Switches

```{r}
get_errors_mb <- function(ids, bin_size, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq){
  
  final_df <- annotate_het_list(ids[1], het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq) %>%
    mutate(bin_id = ceiling(pos / bin_size)) %>%
    group_by(bin_id) %>%
    summarize(beagle_s = sum(switch_b),
              eagle_s = sum(switch_e),
              shapeit_s = sum(switch_s),
              beagle_f = sum(flip_b),
              eagle_f = sum(flip_e),
              shapeit_f = sum(flip_s),
              hets = n())
  
  for(i in 2:length(ids)){
    df2 <- annotate_het_list(ids[i], het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq) %>%
      mutate(bin_id = ceiling(pos / bin_size)) %>%
      group_by(bin_id) %>%
      summarize(beagle_s2 = sum(switch_b),
                eagle_s2 = sum(switch_e),
                shapeit_s2 = sum(switch_s),
                beagle_f2 = sum(flip_b),
              eagle_f2 = sum(flip_e),
              shapeit_f2 = sum(flip_s),
              hets2 = n())
    final_df <- full_join(final_df, df2, by="bin_id") %>%
      replace_na(list("beagle_s" = 0, "eagle_s" = 0, "shapeit_s" = 0,
                      "beagle_s2" = 0, "eagle_s2" = 0, "shapeit_s2" = 0,
                      "beagle_f" = 0, "eagle_f" = 0, "shapeit_f" = 0,
                      "beagle_f2" = 0, "eagle_f2" = 0, "shapeit_f2" = 0,
                      "hets" = 0, "hets2" = 0)) %>%
      mutate(beagle_s = beagle_s + beagle_s2,
             eagle_s = eagle_s + eagle_s2,
             shapeit_s = shapeit_s + shapeit_s2,
             beagle_f = beagle_f + beagle_f2,
             eagle_f = eagle_f + eagle_f2,
             shapeit_f = shapeit_f + shapeit_f2,
             hets = hets + hets2) %>%
      select(bin_id, beagle_s, eagle_s, shapeit_s, beagle_f, eagle_f, shapeit_f, hets)
  }
  return(final_df %>% arrange(bin_id))
}

df_eur <- get_errors_mb(1:200, 1e6, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

df_eur %>%
  ggplot(aes(x = bin_id, y = hets)) +
  geom_point() +
  geom_line() +
  ggtitle("Aggregated Heterozygous Sites per Bin", "EUR Synthetic Diploids") +
  xlab("Bin") +
  ylab("Heterozygous Sites") +
  theme_classic()

df_eur %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
  geom_smooth() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_eur %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "spearman") %>%
  knitr::kable()

```

#### Adjust for het sites

```{r}
df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per MB Bin", "EUR Synthetic Diploids") +
  geom_smooth()

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```


### Flips

```{r}
df_eur %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
  geom_smooth() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
  geom_smooth() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "EUR Synthetic Diploids") +
  geom_smooth()

df_eur %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_eur %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per MB Bin", "EUR Synthetic Diploids") +
  geom_smooth()

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

### Higher Resolution

```{r}
df_eur <- get_errors_mb(1:200, 1e5, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

df_eur %>%
  ggplot(aes(x = bin_id, y = hets)) +
  geom_point() +
  geom_line() +
  ggtitle("Aggregated Heterozygous Sites per Bin", "EUR Synthetic Diploids") +
  xlab("Bin") +
  ylab("Heterozygous Sites") +
  theme_classic()

df_eur %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per 100KB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(eagle_beagle = eagle_s - beagle_s,
         eagle_shapeit = eagle_s - shapeit_s) %>%
  select(bin_id, eagle_beagle, eagle_shapeit) %>%
  pivot_longer(-bin_id, names_to = "Comparison", values_to = "Difference") %>%
  ggplot(aes(x = bin_id, y = Difference, color = Comparison, group = Comparison)) +
    geom_point() +
    theme_classic() +
    xlab("Bin") +
  geom_hline(yintercept = 0) +
  ggtitle("Difference in Switches per 100KB Bin", "EUR Synthetic Diploids") +
  geom_smooth(linewidth = 2.5, color = "black", se = FALSE)+
  geom_smooth()
  
df_eur %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per 100KB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per 100KB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per 100KB Bin", "EUR Synthetic Diploids") +
  geom_smooth()

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per 100KB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per 100KB Bin", "EUR Synthetic Diploids") +
  geom_smooth()

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

### Lower Resolution

```{r}
df_eur <- get_errors_mb(1:200, 1e7, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

df_eur %>%
  ggplot(aes(x = bin_id, y = hets)) +
  geom_point() +
  geom_line() +
  ggtitle("Aggregated Heterozygous Sites per Bin", "EUR Synthetic Diploids") +
  xlab("Bin") +
  ylab("Heterozygous Sites") +
  theme_classic()

df_eur %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per 10MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(eagle_beagle = eagle_s - beagle_s,
         eagle_shapeit = eagle_s - shapeit_s) %>%
  select(bin_id, eagle_beagle, eagle_shapeit) %>%
  pivot_longer(-bin_id, names_to = "Comparison", values_to = "Difference") %>%
  ggplot(aes(x = bin_id, y = Difference, color = Comparison, group = Comparison)) +
    geom_point() +
    theme_classic() +
    xlab("Bin") +
  geom_hline(yintercept = 0) +
  ggtitle("Difference in Switches per 10MB Bin", "EUR Synthetic Diploids") +
  geom_smooth(linewidth = 2.5, color = "black", se = FALSE)+
  geom_smooth()

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per 10MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per 10MB Bin", "EUR Synthetic Diploids") +
  geom_smooth()
  
df_eur %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per 10MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per 10MB Bin", "EUR Synthetic Diploids")

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per 10MB Bin", "EUR Synthetic Diploids") +
  geom_smooth()

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_eur %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```


## AFR

### Switches 

```{r}
df_afr <- get_errors_mb(201:400, 1e6, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq) %>%
  arrange(bin_id)

df_afr %>%
  ggplot(aes(x = bin_id, y = hets)) +
  geom_point() +
  geom_line() +
  ggtitle("Aggregated Heterozygous Sites per Bin", "AFR Synthetic Diploids") +
  xlab("Bin") +
  ylab("Heterozygous Sites") +
  theme_classic()

df_afr %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "AFR Synthetic Diploids")

df_afr %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  geom_smooth() +
  ggtitle("Switches per MB Bin", "AFR Synthetic Diploids")

df_afr %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_afr %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_afr %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per MB Bin", "AFR Synthetic Diploids")

df_afr %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_afr %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

### Flips

```{r}
df_afr %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "AFR Synthetic Diploids")

df_afr %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "AFR Synthetic Diploids") +
  geom_smooth()

df_afr %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_afr %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_afr %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per MB Bin", "AFR Synthetic Diploids")

df_afr %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_afr %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

## AMR

### Switches

```{r}
df_amr <- get_errors_mb(401:600, 1e6, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq) %>%
  arrange(bin_id)

df_amr %>%
  ggplot(aes(x = bin_id, y = hets)) +
  geom_point() +
  geom_line() +
  ggtitle("Aggregated Heterozygous Sites per Bin", "AMR Synthetic Diploids") +
  xlab("Bin") +
  ylab("Heterozygous Sites") +
  theme_classic()

df_amr %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "AMR Synthetic Diploids")

df_amr %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "AMR Synthetic Diploids") +
  geom_smooth()

df_amr %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_amr %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_amr %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per MB Bin", "AMR Synthetic Diploids")

df_amr %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_amr %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

### Flips

```{r}
df_amr %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "AMR Synthetic Diploids")

df_amr %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "AMR Synthetic Diploids") +
  geom_smooth()

df_amr %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_amr %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_amr %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per MB Bin", "AMR Synthetic Diploids")

df_amr %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_amr %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

## EAS

### Switches

```{r}
df_eas <- get_errors_mb(601:800, 1e6, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

df_eas %>%
  ggplot(aes(x = bin_id, y = hets)) +
  geom_point() +
  geom_line() +
  ggtitle("Aggregated Heterozygous Sites per Bin", "EAS Synthetic Diploids") +
  xlab("Bin") +
  ylab("Heterozygous Sites") +
  theme_classic()

df_eas %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "EAS Synthetic Diploids")

df_eas %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "EAS Synthetic Diploids") +
  geom_smooth()

df_eas %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_eas %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_eas %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per MB Bin", "EAS Synthetic Diploids")

df_eas %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_eas %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

### Flips

```{r}
df_eas %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "EAS Synthetic Diploids")

df_eas %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "EAS Synthetic Diploids") +
  geom_smooth()

df_eas %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_eas %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_eas %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per MB Bin", "EAS Synthetic Diploids")

df_eas %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_eas %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

## SAS

### Switches

```{r}
df_sas <- get_errors_mb(801:1000, 1e6, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)

df_sas %>%
  ggplot(aes(x = bin_id, y = hets)) +
  geom_point() +
  geom_line() +
  ggtitle("Aggregated Heterozygous Sites per Bin", "SAS Synthetic Diploids") +
  xlab("Bin") +
  ylab("Heterozygous Sites") +
  theme_classic()

df_sas %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "SAS Synthetic Diploids")

df_sas %>%
  select(bin_id, beagle_s, eagle_s, shapeit_s) %>%
  rename(Beagle = beagle_s, Eagle = eagle_s, SHAPEIT = shapeit_s) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per MB Bin", "SAS Synthetic Diploids") +
  geom_smooth()

df_sas %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_sas %>%
  select(beagle_s, eagle_s, shapeit_s) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_sas %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Switches per Heterozygous Site per MB Bin", "SAS Synthetic Diploids")

df_sas %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_sas %>%
  mutate(beagle = beagle_s / hets,
         eagle = eagle_s / hets,
         shapeit = shapeit_s / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

### Flips

```{r}
df_sas %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "SAS Synthetic Diploids")

df_sas %>%
  select(bin_id, beagle_f, eagle_f, shapeit_f) %>%
  rename(Beagle = beagle_f, Eagle = eagle_f, SHAPEIT = shapeit_f) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per MB Bin", "SAS Synthetic Diploids") +
  geom_smooth()

df_sas %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "pearson") %>%
  knitr::kable()

df_sas %>%
  select(beagle_f, eagle_f, shapeit_f) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

#### Adjust for het sites

```{r}
df_sas %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(bin_id, beagle, eagle, shapeit) %>%
  rename(Beagle = beagle, Eagle = eagle, SHAPEIT = shapeit) %>%
  pivot_longer(-bin_id, names_to = "Method", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Method )) +
    geom_point() +
    geom_line() +
    theme_classic() +
    xlab("Bin") +
  ggtitle("Flips per Heterozygous Site per MB Bin", "SAS Synthetic Diploids")

df_sas %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor() %>%
  knitr::kable()

df_sas %>%
  mutate(beagle = beagle_f / hets,
         eagle = eagle_f / hets,
         shapeit = shapeit_f / hets) %>%
  select(beagle, eagle, shapeit) %>%
  cor(method = "spearman") %>%
  knitr::kable()
```

# Population Comparisons

```{r}
df_eur <- get_errors_mb(1:200, 1e6, het_loc_dir, beagle_switch_dir, eagle_switch_dir, shapeit_switch_dir, df_freq)
```

## Switches

### Beagle

```{r}
df <- data.frame(bin_id = df_eur$bin_id,
                 AFR = df_afr$beagle_s / df_afr$hets,
                 AMR = df_amr$beagle_s / df_amr$hets,
                 EAS = df_eas$beagle_s / df_eas$hets,
                 EUR = df_eur$beagle_s / df_eur$hets,
                 SAS = df_sas$beagle_s / df_sas$hets)

df %>%
  pivot_longer(-bin_id, names_to = "Population", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Population)) +
  geom_point() +
  geom_line() +
  ggtitle("Beagle Switch Rate per MB Bin") + 
  xlab("Bin") +
  theme_classic() +
  scale_color_manual(values = cbPalette)

df %>%
  select(-bin_id) %>% 
  cor() %>%
  knitr::kable()

df %>%
  select(-bin_id) %>% 
  cor(method = "spearman") %>%
  knitr::kable()
```

### Eagle

```{r}
df <- data.frame(bin_id = df_eur$bin_id,
                 AFR = df_afr$eagle_s / df_afr$hets,
                 AMR = df_amr$eagle_s / df_amr$hets,
                 EAS = df_eas$eagle_s / df_eas$hets,
                 EUR = df_eur$eagle_s / df_eur$hets,
                 SAS = df_sas$eagle_s / df_sas$hets)

df %>%
  pivot_longer(-bin_id, names_to = "Population", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Population)) +
  geom_point() +
  geom_line() +
  ggtitle("Eagle Switch Rate per MB Bin") + 
  xlab("Bin") +
  theme_classic() +
  scale_color_manual(values = cbPalette)

df %>%
  select(-bin_id) %>% 
  cor() %>%
  knitr::kable()

df %>%
  select(-bin_id) %>% 
  cor(method = "spearman") %>%
  knitr::kable()
```

### SHAPEIT

```{r}
df <- data.frame(bin_id = df_eur$bin_id,
                 AFR = df_afr$shapeit_s / df_afr$hets,
                 AMR = df_amr$shapeit_s / df_amr$hets,
                 EAS = df_eas$shapeit_s / df_eas$hets,
                 EUR = df_eur$shapeit_s / df_eur$hets,
                 SAS = df_sas$shapeit_s / df_sas$hets)

df %>%
  pivot_longer(-bin_id, names_to = "Population", values_to = "Switches") %>%
  ggplot(aes(x = bin_id, y = Switches, color = Population)) +
  geom_point() +
  geom_line() +
  ggtitle("SHAPEIT Switch Rate per MB Bin") + 
  xlab("Bin") +
  theme_classic() +
  scale_color_manual(values = cbPalette)

df %>%
  select(-bin_id) %>% 
  cor() %>%
  knitr::kable()

df %>%
  select(-bin_id) %>% 
  cor(method = "spearman") %>%
  knitr::kable()
```

## Flips

### Beagle

```{r}
df <- data.frame(bin_id = df_eur$bin_id,
                 AFR = df_afr$beagle_f / df_afr$hets,
                 AMR = df_amr$beagle_f / df_amr$hets,
                 EAS = df_eas$beagle_f / df_eas$hets,
                 EUR = df_eur$beagle_f / df_eur$hets,
                 SAS = df_sas$beagle_f / df_sas$hets)

df %>%
  pivot_longer(-bin_id, names_to = "Population", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Population)) +
  geom_point() +
  geom_line() +
  ggtitle("Beagle Flip Rate per MB Bin") + 
  xlab("Bin") +
  theme_classic() +
  scale_color_manual(values = cbPalette)

df %>%
  select(-bin_id) %>% 
  cor() %>%
  knitr::kable()

df %>%
  select(-bin_id) %>% 
  cor(method = "spearman") %>%
  knitr::kable()
```

### Eagle

```{r}
df <- data.frame(bin_id = df_eur$bin_id,
                 AFR = df_afr$eagle_f / df_afr$hets,
                 AMR = df_amr$eagle_f / df_amr$hets,
                 EAS = df_eas$eagle_f / df_eas$hets,
                 EUR = df_eur$eagle_f / df_eur$hets,
                 SAS = df_sas$eagle_f / df_sas$hets)

df %>%
  pivot_longer(-bin_id, names_to = "Population", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Population)) +
  geom_point() +
  geom_line() +
  ggtitle("Eagle Flip Rate per MB Bin") + 
  xlab("Bin") +
  theme_classic() +
  scale_color_manual(values = cbPalette)

df %>%
  select(-bin_id) %>% 
  cor() %>%
  knitr::kable()

df %>%
  select(-bin_id) %>% 
  cor(method = "spearman") %>%
  knitr::kable()
```

### SHAPEIT

```{r}
df <- data.frame(bin_id = df_eur$bin_id,
                 AFR = df_afr$shapeit_f / df_afr$hets,
                 AMR = df_amr$shapeit_f / df_amr$hets,
                 EAS = df_eas$shapeit_f / df_eas$hets,
                 EUR = df_eur$shapeit_f / df_eur$hets,
                 SAS = df_sas$shapeit_f / df_sas$hets)

df %>%
  pivot_longer(-bin_id, names_to = "Population", values_to = "Flips") %>%
  ggplot(aes(x = bin_id, y = Flips, color = Population)) +
  geom_point() +
  geom_line() +
  ggtitle("SHAPEIT Flip Rate per MB Bin") + 
  xlab("Bin") +
  theme_classic() +
  scale_color_manual(values = cbPalette)

df %>%
  select(-bin_id) %>% 
  cor() %>%
  knitr::kable()

df %>%
  select(-bin_id) %>% 
  cor(method = "spearman") %>%
  knitr::kable()
```

# Recombination Rate

```{r}
rr_df <- rr_df %>%
  mutate(bin_id =  ceiling(pos_start / 1e6))

df_eur %>%
  left_join({rr_df %>%
      select(bin_id, rr) %>%
      group_by(bin_id) %>%
      summarise(rr = mean(rr, na.rm = T))},
      by = "bin_id") %>%
  ggplot(aes(x = bin_id, y = rr)) +
  geom_point() +
  geom_line() +
  theme_classic() +
  xlab("Bin") +
  ylab("deCODE Recombination Rate")

df_afr %>%
  left_join({rr_df %>%
      select(bin_id, rr) %>%
      group_by(bin_id) %>%
      summarise(rr = mean(rr, na.rm = T))},
      by = "bin_id") %>%
  ggplot(aes(x = bin_id, y = rr)) +
  geom_point() +
  geom_line() +
  theme_classic() +
  xlab("Bin") +
  ylab("deCODE Recombination Rate")

df_amr %>%
  left_join({rr_df %>%
      select(bin_id, rr) %>%
      group_by(bin_id) %>%
      summarise(rr = mean(rr, na.rm = T))},
      by = "bin_id") %>%
  ggplot(aes(x = bin_id, y = rr)) +
  geom_point() +
  geom_line() +
  theme_classic() +
  xlab("Bin") +
  ylab("deCODE Recombination Rate")


df_eas %>%
  left_join({rr_df %>%
      select(bin_id, rr) %>%
      group_by(bin_id) %>%
      summarise(rr = mean(rr, na.rm = T))},
      by = "bin_id") %>%
  ggplot(aes(x = bin_id, y = rr)) +
  geom_point() +
  geom_line() +
  theme_classic() +
  xlab("Bin") +
  ylab("deCODE Recombination Rate")

df_sas %>%
  left_join({rr_df %>%
      select(bin_id, rr) %>%
      group_by(bin_id) %>%
      summarise(rr = mean(rr, na.rm = T))},
      by = "bin_id") %>%
  ggplot(aes(x = bin_id, y = rr)) +
  geom_point() +
  geom_line() +
  theme_classic() +
  xlab("Bin") +
  ylab("deCODE Recombination Rate")
```


